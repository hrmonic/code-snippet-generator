{
  "id": "php-crud",
  "name": "CRUD PHP avec PDO",
  "description": "CRUD complet avec PDO et protection contre SQL injection",
  "language": "php",
  "feature": "crud",
  "code": "<?php\n\nclass {{entityName}}Controller {\n    private $db;\n    private $tableName = '{{tableName}}';\n    \n    public function __construct($db) {\n        $this->db = $db;\n    }\n    \n    // CREATE\n    public function create($data) {\n        $fields = implode(', ', array_keys($data));\n        $placeholders = ':' . implode(', :', array_keys($data));\n        \n        $sql = \"INSERT INTO {$this->tableName} ({$fields}) VALUES ({$placeholders})\";\n        $stmt = $this->db->prepare($sql);\n        \n        foreach ($data as $key => $value) {\n            $stmt->bindValue(':' . $key, $value);\n        }\n        \n        return $stmt->execute();\n    }\n    \n    // READ\n    public function findAll() {\n        $sql = \"SELECT * FROM {$this->tableName}\";\n        $stmt = $this->db->prepare($sql);\n        $stmt->execute();\n        return $stmt->fetchAll(PDO::FETCH_ASSOC);\n    }\n    \n    public function findById($id) {\n        $sql = \"SELECT * FROM {$this->tableName} WHERE id = :id\";\n        $stmt = $this->db->prepare($sql);\n        $stmt->bindValue(':id', $id, PDO::PARAM_INT);\n        $stmt->execute();\n        return $stmt->fetch(PDO::FETCH_ASSOC);\n    }\n    \n    // UPDATE\n    public function update($id, $data) {\n        $set = [];\n        foreach (array_keys($data) as $field) {\n            $set[] = \"{$field} = :{$field}\";\n        }\n        $setClause = implode(', ', $set);\n        \n        $sql = \"UPDATE {$this->tableName} SET {$setClause} WHERE id = :id\";\n        $stmt = $this->db->prepare($sql);\n        \n        foreach ($data as $key => $value) {\n            $stmt->bindValue(':' . $key, $value);\n        }\n        $stmt->bindValue(':id', $id, PDO::PARAM_INT);\n        \n        return $stmt->execute();\n    }\n    \n    // DELETE\n    public function delete($id) {\n        $sql = \"DELETE FROM {$this->tableName} WHERE id = :id\";\n        $stmt = $this->db->prepare($sql);\n        $stmt->bindValue(':id', $id, PDO::PARAM_INT);\n        return $stmt->execute();\n    }\n}\n\n// Utilisation\n$controller = new {{entityName}}Controller($pdo);\n$users = $controller->findAll();",
  "variables": [
    {
      "name": "entityName",
      "type": "text",
      "label": "Nom de l'entité",
      "required": true,
      "description": "Nom de la classe Controller (ex: User)",
      "placeholder": "User"
    },
    {
      "name": "tableName",
      "type": "text",
      "label": "Nom de la table",
      "required": true,
      "description": "Nom de la table en base de données (ex: users)",
      "placeholder": "users"
    },
    {
      "name": "includeAllMethods",
      "type": "checkbox",
      "label": "Toutes les méthodes CRUD",
      "required": false,
      "description": "Inclure CREATE, READ, UPDATE, DELETE",
      "defaultValue": true
    },
    {
      "name": "includeErrorHandling",
      "type": "checkbox",
      "label": "Gestion d'erreurs",
      "required": false,
      "description": "Ajouter la gestion d'erreurs avec try/catch",
      "defaultValue": false
    },
    {
      "name": "includeValidation",
      "type": "checkbox",
      "label": "Validation des données",
      "required": false,
      "description": "Ajouter la validation des données d'entrée",
      "defaultValue": false
    }
  ],
  "security": {
    "sqlInjection": true,
    "xss": false
  },
  "tests": "<?php\n// Tests unitaires\nclass {{entityName}}ControllerTest extends PHPUnit\\Framework\\TestCase {\n    public function testCreate() {\n        // Test création\n    }\n    \n    public function testFindAll() {\n        // Test récupération\n    }\n}"
}

